---
title: Resolution Code
tags: [encoding-systems, code, mas-portfolio]
description: A bijection between shapes and texts
start_date: 2024-01-01
date: 2024-02-23
priority: 1
---
import Box from 'src/layouts/Box.astro';
import Img from 'src/components/Img.astro';
import Caption from 'src/layouts/Caption.astro';
import Black from 'src/components/work/resolution-code/Black.astro';
import Split from 'src/components/work/resolution-code/Split.astro';
import White from 'src/components/work/resolution-code/White.astro';
import Sequence from 'src/components/work/resolution-code/Sequence.astro';
import 'src/styles/work/resolution-code.css';

Resolution Code is an evolution of the ideas that prompted me to design [Contour Code]('/work/contouur-code). My original hope with Contour Code was that it could be used to assign meaning to any shape in one’s environment. However, I soon realized that it only works for crisp geometric shapes; most shapes from the real world are too rough or complicated for it to handle. I set out to create a more flexible system that can interpret a fractal just as easily as it interprets a circle. Resolution Code can do this, and it can also encode any given text into a shape, which will usually end up being a fractal. While Contour Code can represent a given text in many different ways depending on the artistic whims of the user, Resolution Code has exactly one way to represent any piece of text. In mathematical terms, it is a bijection between shapes (defined loosely) and strings of characters.

<Img src='resolution-code/udhr.png' uses='ftpb' alt=''/>
<Caption>The Universal Declaration of Human Rights, encoded in Resolution Code</Caption>

The reason Contour Code struggles to interpret many shapes from the real world stems from the way it represents shapes. The system depends on the ability to divide the outline of a shape into series of smooth (straight or curved) segments demarcated by sharp corners. However, most natural objects are rough everywhere with no smooth segments, and most artificial objects are smooth everywhere with no fully sharp corners. To interpret such a shape with Contour Code, one must approximate the shape as a series of smooth segments. This is like tracing a complicated reference image in a vector graphics editor: given the same image, a hundred people would trace it in a hundred different ways, and in Contour Code, each of those options would represent a different string of characters. I wanted a system where any shape corresponds to exactly one string of characters, without requiring any subjective choices. Resolution Code does this by taking an approach inspired by raster graphics instead of vector graphics: a shape is defined not by its outline but by the pixels it covers.

The simplest way to use pixels to interpret a shape would be to define some preset resolution, create an image of the shape at that resolution, and then read off the rows of pixels from top to bottom, creating a string of binary digits where a one indicates a pixel inside the shape and a zero indicates a pixel outside the shape. Then use a text encoding to convert that binary string to a string of characters. This is not satisfactory for a few reasons. First, the text produced by the system depends on the resolution of the image, which is an arbitrary subjective choice. Second, an image at any fixed resolution is incapable of representing detail beyond a certain scale, and so two shapes that are different at a small scale would turn into the same string of text. Finally, any solid enough shape would produce long strings of ones (when many pixels
in a row are inside the shape) followed by long strings of zeros (when many pixels in a row are outside the shape), which would result in the same few characters being repeated over and over.

Resolution Code addresses all of these issues. Rather than using one fixed resolution of image, it represents a shape using a sequence of images at higher and higher resolutions: first 2×2, then 4×4, then 8×8, and so on to infinity, doubling each time. The system represents each of these images as binary digits and appends the digits to an ever-growing string. However, rather than appending the bits for the whole image, it only records the parts that have gained detail since the last iteration: the pixels at the edge of the shape, which are divided into four smaller pixels that represent the edge with more detail. All the other pixels give no new information since last time and don’t need to be written down. The resulting string of binary digits has an even mix of zeros and ones and can be used to reconstruct the shape at an arbitrarily high level of detail.

To this core idea I have been adding refinements, each to achieve a certain aesthetic goal:
- The system also works the other way, to input text and output a shape. To ensure that the output actually looks like a shape, and not just a set of squares stuck to each other, I had to impose some conditions on how each pixel is allowed to be subdivided depending on the pixels touching it.
- These conditions had the side effect of greatly increasing the amount of negative space, creating a light dusting of specks instead of bigger shapes. To counteract this, I apply another encoding to the beginning of the sequence to weight it more heavily with ones over zeros, as that creates more positive space.
- Since the system works by first describing the large-scale structure and then going into finer and finer detail, the first bits (and thus the first characters) have an outsize impact on the shape, while later parts of the string determine nearly indiscernible details. When encoding text, I want every character to have equal influence over the shape. To achieve this, I can have the system apply a transformation inspired by Fourier analysis and checksums to create a new sequence of bits that represents the same information in a more spread-out way.


## Explanation and design process

My goal was to create a process with the following properties:
- You can give it any possible text and it will encode the text into a shape
- You can give it any possible shape and it will decode the shape as text
- If you convert some text to a shape, and then convert that shape to text, it will be the same text you started with
- If you convert a shape into text, and then convert that text to a shape, it will be the same shape you started with

In other words, a [bijection](https://en.wikipedia.org/wiki/Bijection) between texts and shapes.

### Background concepts and exploration

The basic idea is to break the text down into characters, then interpret these characters as a description of a shape. But “a description of a shape” is rather vague. There are many ways to describe shapes. For example, consider this shape:

<Img src="resolution-code/diagrams/shape.svg" alt=""/>



You could describe it using several methods:
1. *Construct it from simpler shapes:* “An overlapping square and circle of about equal size, with the circle covering the bottom left corner of the square.”
2. *Give instructions for drawing the outline:* “Starting from the top right corner, draw a line that is 2 units long and headed down, then a line 1 unit left, a clockwise arc from 3:00 to 12:00 with a radius of 1 unit, a line 1 unit up, and a line 2 units right.”
3. *Mathematically define a set of points on a coordinate plane:* “A shape composed of all the points that are either within 1 unit of (0, 0) or that have both *x* and *y* coordinates between 0 and 2.”
4. *Approximate it with a pixelated image:* “Set up a 300×300 grid of pixels. From left to right and top to bottom, the pixels are colored as follows: white, white, white, white, white… *(repeated many times)* …white, white, black, black, black, black, black… *(repeated many times)* …black, black, white, white, white, white, white… *(and so on for all 90,000 pixels)*.”

Recall that the goal is to be able to describe *any* shape, including complicated natural shapes like this:

<Img src="resolution-code/diagrams/tree.png" alt=""/>

Some types of description are better for this than others. Constructing it from simple geometric shapes (1) wouldn’t really work, since it’s not composed of such shapes. Describing how to draw the outline (2) also wouldn’t work very well — the outline is so rough that it would take a huge number of very fine-grained steps to even start to approximate it, and there’s no good way to decide on one approximation over another. Giving a mathematical definition (3) isn’t good because the shape doesn’t conform to any simple mathematical function.

Using pixels (4), however, works great. So let’s say that this encoding process will describe a shape as a grid of pixels, each of which can either be black or white. (Of course shapes don’t have to be black and white — more generally I could be saying figure/ground or inside/outside, but I’ll say black/white for simplicity.) Therefore our goal is to create a process that inputs some text and outputs a list of black/white pixels that can be put together into an image.

One way to do this is to convert the text to Morse code, and then say that a dot becomes a white pixel while a dash becomes a black pixel. For example, “word” in Morse code is

<pre class="morse centered konsole">.-- --- .-. -..</pre>

which converts to this sequence of pixels:

<Img src="resolution-code/diagrams/morse word line.svg" alt=""/>

We can then arrange these pixels into the rows of a (very low resolution) image, like this:

<Img src="resolution-code/diagrams/morse word 4×3.svg" alt=""/>

That worked fine, but there are some issues with this approach. First, why arrange them into a 4×3 image, and not a 3×4 image? We could just as well have made this image out of the same sequence of pixels:

<Img src="resolution-code/diagrams/morse word 3×4.svg" alt=""/>

In this system for converting from text to images (I won’t really call this a “shape” yet) we have to make an arbitrary choice for what image dimensions to use. But part of the goal is to create a system that has exactly one way to encode any text into an image. If there are multiple ways to convert from text to image — as there are when the dimensions aren’t set — then it isn’t possible to unambiguously convert from image to text and back. If you convert an image to text, you give someone else the text, and they convert that text into an image, they might get the wrong image because they have no way of knowing what dimensions they were upposed to use.

Also, the way we’re using the code is ambiguous. Morse Code relies on pauses or spaces to indicate when one letter ends and the next begins, but those aren’t represented here. If you read the image, all you get is this:
<pre class="morse centered konsole">.-----.-.-..</pre>

which *could* say “word” (<span class="morse konsole">.-- --- .-. -..</span>), but it could also say “ammeki” (<span class="morse konsole">.- -- -- . -.- ..</span>), or many other things.

To address these issues, let’s do two things:

(1) **Define the width of the image beforehand.** This way, as we’re setting down the black and white pixels into rows, we always know where to go back to start a new row, rather than having to guess at the image dimensions. Let’s go with 300 pixels wide for now.

(2) **Use an unambigous encoding system.** Any binary encoding will be designed to have this proprty, since computers need to be able to tell what text is represented from just the zeros and ones without relying on gaps between them. Usually they do this by making each character the same length — if every character is represented by 8 digits, then you always know where one ends and the next begins.

We could use an existing encoding, like <span class="sc">ASCII</span> or Unicode, but these have some digit sequences that don’t represent actual characters. If you use this system to interpret an arbitrary image, you don’t want a quarter of the resulting characters to be invisible instructions for a nonexistent [teletype machine](https://en.wikipedia.org/wiki/ASCII#Control_code_table). So let’s use a custom encoding that doesn’t include those things:

<div id="crh-encoding">
  <div class="encoding-col" id="encoding-1">
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00000</span><span class="character long">space</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00001</span><span class="character">a</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00010</span><span class="character">b</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00011</span><span class="character">c</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00100</span><span class="character">d</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00101</span><span class="character">e</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00110</span><span class="character">f</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>00111</span><span class="character">g</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01000</span><span class="character">h</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01001</span><span class="character">i</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01010</span><span class="character">j</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01011</span><span class="character">k</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01100</span><span class="character">l</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01101</span><span class="character">m</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01110</span><span class="character">n</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>01111</span><span class="character">o</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10000</span><span class="character">p</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10001</span><span class="character">q</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10010</span><span class="character">r</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10011</span><span class="character">s</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10100</span><span class="character">t</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10101</span><span class="character">u</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10110</span><span class="character">v</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>10111</span><span class="character">w</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11000</span><span class="character">x</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11001</span><span class="character">y</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11010</span><span class="character">z</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11011</span><span class="character">.</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11100</span><span class="character">,</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11101</span><span class="character">'</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11110</span><span class="character">"</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">1</span>11111</span><span class="character">-</span></div>
  </div>
  <div class="encoding-col" id="encoding-01">
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00000</span><span class="character long">new line</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00001</span><span class="character">A</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00010</span><span class="character">B</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00011</span><span class="character">C</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00100</span><span class="character">D</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00101</span><span class="character">E</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00110</span><span class="character">F</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>00111</span><span class="character">G</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01000</span><span class="character">H</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01001</span><span class="character">I</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01010</span><span class="character">J</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01011</span><span class="character">K</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01100</span><span class="character">L</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01101</span><span class="character">M</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01110</span><span class="character">N</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>01111</span><span class="character">O</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10000</span><span class="character">P</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10001</span><span class="character">Q</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10010</span><span class="character">R</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10011</span><span class="character">S</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10100</span><span class="character">T</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10101</span><span class="character">U</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10110</span><span class="character">V</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>10111</span><span class="character">W</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11000</span><span class="character">X</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11001</span><span class="character">Y</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11010</span><span class="character">Z</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11011</span><span class="character">:</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11100</span><span class="character">;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11101</span><span class="character">?</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11110</span><span class="character">!</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">01</span>11111</span><span class="character">/</span></div>
  </div>
  <div class="encoding-col" id="encoding-00">
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00000</span><span class="character">0</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00001</span><span class="character">1</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00010</span><span class="character">2</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00011</span><span class="character">3</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00100</span><span class="character">4</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00101</span><span class="character">5</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00110</span><span class="character">6</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>00111</span><span class="character">7</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01000</span><span class="character">8</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01001</span><span class="character">9</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01010</span><span class="character">(</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01011</span><span class="character">)</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01100</span><span class="character">&#91;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01101</span><span class="character">&#93;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01110</span><span class="character">&#123;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>01111</span><span class="character">&#125;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10000</span><span class="character">=</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10001</span><span class="character">&lt;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10010</span><span class="character">&gt;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10011</span><span class="character">+</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10100</span><span class="character">*</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10101</span><span class="character">^</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10110</span><span class="character">%</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>10111</span><span class="character">~</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11000</span><span class="character">_</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11001</span><span class="character">&#92;</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11010</span><span class="character">|</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11011</span><span class="character">`</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11100</span><span class="character">#</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11101</span><span class="character">$</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11110</span><span class="character">@</span></div>
    <div class="encoding-pair"><span class="encoding"><span class="prefix">00</span>11111</span><span class="character">&amp;</span></div>
  </div>
</div>

Here, some of the characters are 6 bits long, while others are 7, but it’s still unambiguous — if you look at the first bit and it’s <span class="encoding prefix">1</span>, that tells you the encoding is 6 bits long, while if the first bit is <span class="encoding prefix">0</span>, that tells you it’s 7 bits long. So you can always tell when one character ends and the next begins.

To convert an encoding to an image, let’s say that 0 is white and 1 is black. (If you’re a designer I know this might be the opposite of what you’re used to, but remember that “black” is really just shorthand for “a point inside the shape” while “white” means “outside the shape.” In is 1, out is 0.) 


Now that we have this system, let’s encode some longer text. Here’s the [<span class="sc">UDHR</span>](https://www.ohchr.org/en/universal-declaration-of-human-rights) again:

<Img src="resolution-code/tests/udhr.png" alt=""/>

Hmm... that’s not really a shape; it just looks like noise.

Let’s also try going the other way, and convert a shape into text. Here’s what happens when we “read” a circle:

<Box factor={0.6}>
<Img src="resolution-code/tests/circle.png" id="circle" alt=""/>
<p id="circle-arrow">↓</p>
<div id="circle-decoded">
<p>0000000000000000001-----"0000000000000000000000000000000000007-------"00000000000000000000000000000000001----------000000000000000000000000000000000&#93;-----------00000000000000000000000000000000&------------ 000000000000000000000000000000&#93;-------------,000000000000000000000000000001--------------- 00000000000000000000000000007---------------"0000000000000000000000000000&----------------x000000000000000000000000000&----------------- 00000000000000000000000000&------------------ 00000000000000000000000007------------------- 0000000000000000000000001--------------------x000000000000000000000000&#93;--------------------,000000000000000000000000----------------------000000000000000000000003----------------------p00000000000000000000007----------------------"0000000000000000000000&#93;-----------------------p000000000000000000000&#93;------------------------0000000000000000000007------------------------x000000000000000000003-------------------------p00000000000000000000--------------------------p00000000000000000007-------------------------- 0000000000000000000---------------------------p0000000000000000003---------------------------p000000000000000000&---------------------------x000000000000000000----------------------------,000000000000000003-----------------------------000000000000000007----------------------------- 0000000000000000&#93;-----------------------------,0000000000000000&#93;------------------------------0000000000000000&#93;------------------------------p0000000000000007------------------------------"0000000000000007-------------------------------x000000000000001-------------------------------- 00000000000000&-------------------------------"000000000000007--------------------------------x00000000000000---------------------------------p00000000000007--------------------------------- 0000000000000/---------------------------------0000000000000&#93;----------------------------------0000000000000-----------------------------------0000000000003-----------------------------------000000000000&#93;-----------------------------------000000000000/-----------------------------------000000000001------------------------------------ 00000000001------------------------------------x00000000000------------------------------------,00000000000-------------------------------------00000000000-------------------------------------p0000000000/------------------------------------,0000000000/-------------------------------------0000000000/-------------------------------------p000000000&-------------------------------------"000000000&#93;--------------------------------------p000000001--------------------------------------"000000000/--------------------------------------p00000000&#93;---------------------------------------000000003---------------------------------------,00000000/---------------------------------------p00000003----------------------------------------00000000/---------------------------------------,00000007----------------------------------------x0000000&---------------------------------------- 0000001----------------------------------------- 0000007----------------------------------------- 000000&#93;-----------------------------------------0000000------------------------------------------0000003------------------------------------------0000007-----------------------------------------"000000&-----------------------------------------"000000-------------------------------------------000000-------------------------------------------000001------------------------------------------- 00000-------------------------------------------p00000-------------------------------------------,00000--------------------------------------------00000/-------------------------------------------00000--------------------------------------------p0000&-------------------------------------------x0000&-------------------------------------------"0000&#93;--------------------------------------------0000&#93;--------------------------------------------p0003--------------------------------------------,0001--------------------------------------------- 000&--------------------------------------------x000&#93;---------------------------------------------0003---------------------------------------------p000----------------------------------------------000&#93;---------------------------------------------p001---------------------------------------------"000/---------------------------------------------p007---------------------------------------------"001----------------------------------------------x00&#93;----------------------------------------------001----------------------------------------------x00&---------------------------------------------- 01----------------------------------------------"00&----------------------------------------------x01----------------------------------------------- 07----------------------------------------------"00-----------------------------------------------,03-----------------------------------------------p0&#93;-----------------------------------------------01-----------------------------------------------"07-----------------------------------------------x0&----------------------------------------------- 1------------------------------------------------ 3------------------------------------------------0&#93;-----------------------------------------------,0/-----------------------------------------------p3------------------------------------------------p7------------------------------------------------ &#93;------------------------------------------------0/-----------------------------------------------,3------------------------------------------------,7------------------------------------------------x&#93;------------------------------------------------p&------------------------------------------------ ------------------------------------------------- -------------------------------------------------p-------------------------------------------------p-------------------------------------------------p-------------------------------------------------p-------------------------------------------------q-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------.-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------'-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------y-------------------------------------------------x-------------------------------------------------p-------------------------------------------------p-------------------------------------------------p-------------------------------------------------p-------------------------------------------------p/------------------------------------------------1------------------------------------------------"3------------------------------------------------,7------------------------------------------------x&#93;------------------------------------------------p&#93;------------------------------------------------0/-----------------------------------------------,1------------------------------------------------x3------------------------------------------------p3------------------------------------------------0&#93;-----------------------------------------------,0/-----------------------------------------------p1------------------------------------------------ 1-----------------------------------------------"07-----------------------------------------------x0&----------------------------------------------- 0/----------------------------------------------,03-----------------------------------------------p0&#93;-----------------------------------------------00/----------------------------------------------p03-----------------------------------------------00&----------------------------------------------x00-----------------------------------------------007----------------------------------------------x00&---------------------------------------------"003----------------------------------------------p00&---------------------------------------------"001---------------------------------------------- 00&#93;---------------------------------------------,000----------------------------------------------000&#93;---------------------------------------------p001---------------------------------------------"000&#93;---------------------------------------------0003---------------------------------------------p000&--------------------------------------------x0007--------------------------------------------"0000---------------------------------------------0000&-------------------------------------------- 0003--------------------------------------------p0000--------------------------------------------,0000&#93;-------------------------------------------,00007-------------------------------------------"00001-------------------------------------------"00000--------------------------------------------00000&------------------------------------------"00000&#93;------------------------------------------,00000&#93;------------------------------------------,000007------------------------------------------x000007------------------------------------------x000003------------------------------------------p000001------------------------------------------ 000001------------------------------------------ 000000------------------------------------------0000000-----------------------------------------,0000001-----------------------------------------x0000001----------------------------------------- 0000001----------------------------------------"00000007----------------------------------------x0000000&#93;----------------------------------------00000000/---------------------------------------p00000003----------------------------------------00000000&#93;---------------------------------------p00000000/--------------------------------------,000000003---------------------------------------000000000&-------------------------------------- 000000003--------------------------------------,000000000&-------------------------------------"0000000003--------------------------------------0000000000/-------------------------------------0000000000&#93;-------------------------------------00000000003-------------------------------------00000000000-------------------------------------00000000000&-----------------------------------"00000000000&-----------------------------------"00000000000&#93;-----------------------------------,000000000007-----------------------------------x000000000003-----------------------------------p000000000001----------------------------------- 000000000000-----------------------------------0000000000000----------------------------------,0000000000000/---------------------------------00000000000001---------------------------------x00000000000003---------------------------------00000000000000&#93;--------------------------------p00000000000000/-------------------------------,000000000000003--------------------------------000000000000000&------------------------------- 000000000000000-------------------------------p0000000000000007------------------------------x0000000000000000------------------------------,0000000000000000&#93;-----------------------------,00000000000000001-----------------------------x00000000000000000/----------------------------p00000000000000000&#93;----------------------------000000000000000000&#93;---------------------------,0000000000000000007--------------------------- 0000000000000000007--------------------------"00000000000000000007-------------------------- 0000000000000000000&#93;-------------------------,00000000000000000000&------------------------"000000000000000000000-------------------------0000000000000000000007------------------------ 000000000000000000000&----------------------- 0000000000000000000001----------------------- 0000000000000000000000&#93;----------------------000000000000000000000003---------------------,000000000000000000000000---------------------p000000000000000000000000&-------------------"0000000000000000000000000&#93;-------------------00000000000000000000000000&------------------ 00000000000000000000000000&----------------- 000000000000000000000000000-----------------p0000000000000000000000000001---------------- 00000000000000000000000000007--------------"000000000000000000000000000000--------------p0000000000000000000000000000007------------x00000000000000000000000000000001-----------x000000000000000000000000000000000/---------00000000000000000000000000000000000--------p000000000000000000000000000000000000/-----000000000000000000</p>
</div>
</Box>

The white region of the image has long stretches of white pixels, which become a bunch of zeros, and since the sequence <span class="encoding">0000000</span> encodes the *character* zero we have long stretches of zeros. Similarly, the black region becomes a bunch of ones, which results in long stretches of hyphens.

What these examples show is that, while it is possible to represent any shape by listing its pixels row by row, this type of description misses a core fact about how shapes work — the fact that shapes are contiguous blocks of space that are fully black, surrounded by a contiguous block of white space. Because the system so far doesn’t understand this fact about shapes, it uses a lot of redundant characters to spell out all these contiguous blocks when we decode an image. And because it doesn’t understand how shapes work, it doesn’t produce real shapes when we give it arbitrary text.

### Designing a new process for describing shapes

Resolution Code uses a different way of describing shapes that better understands how they work. It starts by representing an image at a very low resolution, and then adds more and more detail, but only in the places that need detail.

Let’s look at how it describes this shape/image (contrived to be a good example):

<Img classes={["shape-building"]} src="resolution-code/diagrams/sample shape.svg" alt=""/>

We will start by representing this image at a 2×2 resolution. I’ll overlay a blank 2×2 grid on top of this, with the pixels waiting to be filled in:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 1 0.svg" alt=""/>

Now let’s use the shape as a guide to fill in the pixels. The top left pixel covers a region of the image that’s fully white, so we can color this pixel white:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 1 1.svg" alt=""/>

The top right pixel covers a region that’s partly black and partly white. We need more detail to represent what’s going on here, so we *split it into four smaller pixels* that we’ll return to later.

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 1 2.svg" alt=""/>

We proceed to the next row: the bottom left pixel is fully white, while the bottom right needs to be split:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 1 3.svg" alt=""/>

Now we’ve reached the bottom of the image. At this point we’ve already defined half of the image. But there is the other half that needs more detail. So we go back and start a second iteration, doing the same thing at a smaller scale. As before, we read from left to right, then top to bottom. The first one needs to be split:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 2 1.svg" alt=""/>

The second one is fully black:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 2 2.svg" alt=""/>

And so on:

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 2 end.svg" alt=""/>

As we go, we keep track of what we did with each pixel. In the first iteration earlier, the first pixel was <White/>, the second was <Split/>, the third was <White/>, and the fourth was <Split/>. In second iteration that we just finished, the instructions were <Sequence instrs={"sbsbssww"}/>.

A third iteration: as you go through the pixels remaining in the above image, the shape indicates that the next instructions are <Sequence instrs={"sbsbsbsswssbwwss"} small={true}/>.

<Img classes={["shape-building"]} src="resolution-code/diagrams/iteration 3.svg" alt=""/>

We can keep doing this indefinitely, describing the shape in ever-increasing detail and producing an ever-growing sequence:

<div id="extending-sequence">
  <Sequence instrs={"wswssbsbsswwsbsbsbsswssbwwsssbsbsbsbsswswssbwwsbssbbwssbsssbwwss"} small={true}/>
</div>

With only this sequence, you could reconstruct the shape in as much detail as you’d like.

So at the moment we have a system that inputs a sequence of B/W/S instructions and outputs a shape. To represent text, we just have to assign each character to a different sequence of Black, White, and Split instructions
space BBB
a BBW
b 
...
z SSS
Let’s test it! Here’s (text):


This is better than the noise we had earlier, but it’s not great. We don’t want it to look like a bunch of squares stuck together; we want it to look like one shape.

So how can we prevent it from getting so blocky? Notice that all these hard edges come about when a black pixel and a white pixel touch:

So let’s see what happens if we don’t allow black and white pixels to touch.
For the next bit let’s forget about trying to represent text: let’s just say that for each pixel, we randomly choose what to do with it. So far, for any pixel, we’ve been selecting from three options: black, white, and split. But this new rule, that black and white can’t touch, complicates things a bit.
Let’s say we’re selecting what to do with this pixel. Because it is touching a pixel that we’ve already chosen to be white, this one can’t be black — it can only be white or split. So we only have two options to choose from.
Similarly, this one can’t be white: it can only be Black or Split:
This one is touching both black and white, so it can only be Split:
And this one is only touching split, so all three options are possible:

Now let’s generate a shape using these rules. For each pixel, we look at the four others it’s touching to figure out which of the three options is allowed. Then we select one of those allowed options at random.

Now we’re getting somewhere! This looks much more like a shape you’d find in nature.
However, the places where this shape touches the edge of the frame are still hard edges. It almost appears to be going out of the frame. To fix this, we will disallow any pixel on the edge from being black, as though the image were framed with a strip of white. Here’s what this produces:


While these shapes do lack the hard line from before, they’re way too small. Why is that?
Consider how this is generated. We start with four pixels, none of which can be black because they’re touching the edge. So each of them has an equal chance of being white or split. So after the first iteration, we’ve already colored in half of the image white on average, severely limiting how big the black shape can be. In the remaining split pixels, the same thing takes place at a smaller scale. Black pixels can only show up in places that are entirely surrounded by split pixels, which requires an unlikely coincidence to happen.
To fix this, let’s weight the random generator so that split and black are generated much more often than white:

This does create a bigger shapes — but it’s back to looking more blocky. It seems that a weighted generator is better for making bigger shapes, but an unweighted generator is better for making more natural shapes. So as a compromise, let’s start by using a weighted generator for the first 20-30 instructions, but then switch to unweighted afterward. The weighted generator carves out a lot of space that black can go in, and then the unweighted generator takes over to make better-looking details.



Now let’s figure out how to make these shapes represent text. There are two parts to this: 
Choosing the text encoding: what sequence of digits represents each character.
Determining how to use these digits as instructions for selecting black / white / split pixels.
(2) is the hard part. Previously we had this encoding:
(base 3 thing)
This gives a sequence of white/black/split instructions. However, we can’t really use a sequence like that anymore, since we’ve imposed rules that disallow certain instructions. For example, we can’t write ___: the encoding for _ (first letter) wants us to color a pixel in black, but we can’t do that because a black pixel can’t touch the edge. Indeed we can’t write anything starting with ____, because those all have black in their encodings.
Because it is so common to only have two options, a binary encoding works better. We can use this one from earlier, and interpret the string of bits according to these rules:


If a pixel is touching white:Look at the next bit in the sequence. If that bit is 0, color the pixel white; if it’s 1, split the pixel.
If a pixel is touching black:Look at the next bit in the sequence. If that bit is 0, split the pixel; if it’s 1, color the pixel black.
If a pixel is touching both white and black:Split the pixel. You don’t need to use any bits to determine what to do since there’s only one option.
If a pixel is touching neither black nor white:Look at the next bit in the sequence. If it’s 1, color the pixel black. If it’s 0, then look at the bit after the 0. If that bit is 1, split the pixel. If it’s 0, color the pixel white.
(diagram)


These rules let us turn text into shapes. They can also be applied the other way round, to decode a shape into text. As you break down a shape, you still get a sequence of black/white/split, like before. But now, rather than jsut writing a pixel as black/white/split, consider the context of that pixel and what previously-decoded pixels it’s touching, and use that context to represent the instruction using digits. (etc)


If we use the system as it is now, we’d still run into this issue where all the shapes are very small. When we were randomly choosing the instructions, we dealt with this by weighting the random generator for the first few iterations. How can we have a similar effect now?
What we want is for the digits at the beginning to have more 1’s than 0’s. I designed the encoding so that a 1 creates the most opportunities for black pixels — if it’s possible to make a pixel black, 1 will do that; otherwise it will split the pixel, so at least part of it might be black.
We could just add in more 1’s in at the beginning — interleave 1’s between the first 30 digits, or something like that. That does work to turn a text into a better shape:

However, recall that part of the goal is that if we take a shape and decode it as text, and then encode that text into a shape, it will be the same shape we started with. This solution violates that goal. If the encoding process involves adding extra bits in, the shape that comes out will be different than what we started with.
Instead, what we can do is to use a different encoding for the first characters: one that uses more 1’s than 0’s, but can still be used to interpret any sequence of bits. For example, something like this:
0
10
110
1110
11110
...
space: 1111111
(or come up with a different one if this is too many 1’s)

While every letter is made of a different number of digits, this encoding is still unambigous — given any sequence of digits, you can always tell what the next character is supposed to be. For example, 1100101110 can only be divided up as 110 0 10 1110.
Not every sequence of bits can be divided up according to this encoding: for example, with 11011, we can say it starts with 110 (C), but then we have a dangling 11 that doesn’t correspond to any letter. This might feel like a problem, but it’s unavoidable — any encoding will encounter situations like this. In our other binary encoding, the one we use after the first ___ characters, every letter is 5 bits long, so it can’t fully interpret a sequence whose length isn’t a multiple of 5 — there will be dangling digits at the end.
Does this mean that there are some shapes that can’t be decoded? No: recall that the process of decoding a shape produces an unending sequence of black/white/split instructions describing the shape in more and more detail, and thus we get an unending sequence of bits. So if we’re decoding a shape and we get a sequence starting with 11011 — that sequence that left the dangling 1’s — then we can just keep decoding and those dangling 1’s will end up becoming part of some larger sequence representing a letter. There will always be more bits.

(So how, then, do we deal with the fact that any text we’d want to encode is finite? My solution is simply to repeat the text indefinitely, as many times as you need to create a sufficiently detailed shape.)

There are a few remaining details to figure out. Let’s say we wanted to encode the text “aaaah“. Using the weighted encoding gives
000011111110
The first 0 tells us what to do with the upper left pixel: out of the two options of white vs split, it chooses white. The next three 0’s choose white in all the other pixels. And now what do we do with the 1? There are no more undefined pixels that could be split or colored in. So in the current rules, it’s impossible to represent any sequence starting with four A’s.
To deal with this, I’ll add a rule that if there is only one undefined pixel left, it can only be split, not colored in. This ensures that there will always be places to encode the next digit. So here, the first three 0’s do the same thing as before:
Then the next pixel is automatically split. And then we encode the next 0, and the 1’s, etc.

(heading)
(something about not replacing all four of a split with the same color)
(something about framing, get to this later if I have time)