---
import Article from '@src/layouts/Article.astro';
import Img from '@src/components/Img.astro'
import { getCollection, getEntry, render } from 'astro:content';
import { hasPage } from '@src/scripts/utilities.js'

export async function getStaticPaths() {
  const workPages = (await getCollection('items')).filter(hasPage)
  return workPages.filter(entry => !(entry.data.draft)).map(entry => ({
    params: { slug: entry.id }, props: { entry },
  }))
}

const { entry } = Astro.props;
const { Content, remarkPluginFrontmatter } = await render(entry);

const backlinks = []
for (let tag of entry.data.tags) {
  const tagItem = await getEntry('items', tag.id)
  if (hasPage(tagItem)) {
    backlinks.push({
      name: tagItem.data.name,
      url: '/work/' + tagItem.id
    })
  }
}
---

<Article title={entry.data.title} backlinks={backlinks} description={entry.data.description}}>
  {entry.data.page === 'auto' ?
  <Img src={entry.data.mainImage} alt="test"/> :
  <Content />}
</BaseLayout>